<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATV Player</title>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <style>
    body { margin: 0; background: #000; color: #fff; font-family: sans-serif; }
    #player { width: 100vw; height: 56.25vw; max-height: 400px; position: relative; background: #000; }
    .atv-logo { position: absolute; top: 15px; left: 15px; background: rgba(255,0,0,0.9); padding: 4px 12px; border-radius: 4px; z-index: 100; font-weight: bold; pointer-events: none; }
    #channel-list { padding: 15px; }
    .channel-item { background: #222; margin-bottom: 8px; padding: 12px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; }
    .channel-item:hover { background: #333; }
    .channel-item img { width: 40px; height: 40px; margin-right: 15px; border-radius: 4px; }
  </style>
</head>
<body>

<div id="player">
  <div class="atv-logo">ATV</div>
</div>

<div id="channel-list">
  <h4>Loading Channels...</h4>
</div>

<script>
  // ၁။ m3u ဖိုင် link ကို ဒီမှာ ထည့်ပါ
  const M3U_URL = 'm.m3u'; 

  var player = new Clappr.Player({
    source: "https://pull.niur.live/live/stream-351530_lhd.m3u8?txSecret=5e3422d3df2ee4b55bb0e671a1bffebb&txTime=6987aa86",
    parentId: "#player",
    width: '100%', height: '100%',
    autoPlay: true, mute: true
  });

  // ၂။ m3u ဖိုင်ကို ဖတ်ပြီး List ထုတ်ပေးမည့် Function
  async function loadPlaylist() {
    try {
      const response = await fetch(M3U_URL);
      const data = await response.text();
      const lines = data.split('\n');
      const listContainer = document.getElementById('channel-list');
      listContainer.innerHTML = '';

      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('#EXTINF')) {
          const info = lines[i];
          const url = lines[i + 1].trim();
          const name = info.split(',')[1];
          const logoMatch = info.match(/tvg-logo="([^"]+)"/);
          const logo = logoMatch ? logoMatch[1] : 'https://via.placeholder.com/40';

          const item = document.createElement('div');
          item.className = 'channel-item';
          item.innerHTML = `<img src="${logo}"> <span>${name}</span>`;
          item.onclick = () => {
            player.configure({ source: url, autoPlay: true });
            player.play();
            window.scrollTo({ top: 0, behavior: 'smooth' });
          };
          listContainer.appendChild(item);
        }
      }
    } catch (e) {
      document.getElementById('channel-list').innerHTML = 'Error loading playlist.';
    }
  }

  loadPlaylist();
</script>
</body>
</html>
